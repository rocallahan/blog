---
layout: "post"
title: "Microsoft's Azure Time-Travel Debugging"
date: "2019-05-24 22:38:00 +0000"
permalink: "/2019/05/microsofts-azure-time-travel-debugging.html"
---
<p><a href="https://devblogs.microsoft.com/visualstudio/introducing-time-travel-debugging-for-visual-studio-enterprise-2019/">This</a> looks pretty cool. <a href="https://www.youtube.com/watch?v=qFhJLbh6zzc">The video</a> is also instructive. 
<p>It's not totally clear to me how this works under the hood, but apparently they have hooked up the Nirvana TTD to the .NET runtime so that it will enable TTD recording of invocations of particular methods. That means you can inspect the control flow, the state of registers (i.e. local variables), and any memory read by the method or its callees, at any point during the method invocation. It's not clear what happens if you inspect memory outside the scope of the method (e.g. global variables) or if you inspect memory that was modified concurrently by other threads. Plus there are performance and other issues listed in the blog post.
<p>This seems like a good idea but somewhat more limited than a full-fledged record-everything debugger like rr or WinDbg-TTD. I suspect they're  pushing this limited-scope debugging as a way to reduce run-time overhead. Various people have told me that WinDbg-TTD has almost unusably high overhead for Firefox ... though other people have told me they found it tolerable for their work on Chrome, so data is mixed.
<p>One interesting issue here is that if I was designing a Nirvana-style multithread-capable recorder for .NET applications &mdash; i.e., one that records all memory reads in some fashion via code instrumentation &mdash; I would try building it into the .NET VM itself, like <a href="https://chrononsystems.com/">Chronon</a> for Java. That way you avoid recording stuff like GC (noted as a problem for this Azure debugger), and the JIT compiler can optimize your instrumentation. I guess Microsoft people were looking for a way to deploy TTD more widely and decided this was the best option. That would be reasonable, but it would be a "solution-driven" approach to the problem, which <a href="/2010/04/changing-world_19.html">I have strong feelings about</a>.