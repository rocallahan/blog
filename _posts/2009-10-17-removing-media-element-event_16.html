---
layout: "post"
title: "Removing The Media Element &#39;load&#39; Event"
date: "2009-10-16 17:59:00 +0000"
categories: "Mozilla"
permalink: "/2009/10/removing-media-element-event_16.html"
---
<div class="columns"><p>Yesterday I checked in a patch that removes support for the 'load' event on &lt;video&gt; and &lt;audio&gt; elements. We simply never fire it. Also, the <code>networkState</code> attribute is now never <code>NETWORK_LOADED</code>. When we've read to the end of the media resource, <code>networkState</code> changes to <code>NETWORK_IDLE</code>. We plan to ship this change for Firefox 3.6.<br/><p>There are several reasons we're doing this, even though it will break some Web content. One reason is that the spec says that 'load' should only fire when/if we guarantee that we will never again hit the network for data for that media resource. We never guarantee this, because our cache may always discard data. For example if you play through a large media file that doesn't fit in the cache, we'll read from the network again if you seek back to the beginning. If you play through a resource that does fit in the cache, and then play another large resource we might evict blocks from the first resource to make room for the second resource. So we never followed the spec here, and if we do follow the spec then we can never fire the 'load' event.<br/><p>Another reason is that 'load' is a dangerous and fairly useless event. Web authors expect that every media element will eventually receive a 'load' event, because documents and images do, right? But that expectation is in vain, in many situations a 'load' event will never be fired. Furthermore authors cannot predict those situations because they depend on client cache size and policy. It is quite likely that the author will always get 'load' events during testing but some clients won't get a 'load' event and the site will be broken for those clients. So since the 'load' event won't ever fire in some browsers, and in other browsers will fail to fire in unpredictable situations, authors should never use it. In practice we see authors inappropriately using 'load' when they should be using another event like 'canplaythrough' or 'suspend'.<br/><p>In fact, this argument is persuasive enough that 'load' for media elements and the NETWORK_LOADED state have been removed from the spec. There was consensus from Mozilla, Google, Apple and Opera developers that this is the right thing to do. I expect that other browsers will be following suit soon; in fact, apparently Chrome has never fired a 'load' event on media elements.<br/><p>If you have been using 'load' on your &lt;video&gt; or &lt;audio&gt; elements, you should use a different event. There are several to choose from depending on what you actually want:<br/><ul><br/><li>If you want to do something when the video metadata is available (e.g. duration or size), use 'loadedmetadata'.<br/><li>If you want to do something when the first frame of video can be displayed, use 'loadeddata'.<br/><li>If you want to do something when the browser has stopped downloading the resource, use 'suspend'. Note however that the browser might stop before reaching the end of the resource, e.g. if its cache fills up, or the element doesn't have 'autobuffer' set.<br/><li>If you want to do something when there's enough data loaded to start playing, use 'canplay'.<br/><li>If you want to do something when there's enough data loaded to start playing <em>and</em> playback should be able to make it to the end without stalling on the network, use 'canplaythrough'. Note however that 'canplaythrough' might not fire because the browser's cache fills up, in which case you'll get a 'suspend'.<br/><li>If you want to do something when the video has finished playing, use 'ended'.<br/></ul><br/></div><br/><br/>
<div class='comments'><h2>Comments</h2>
<div class='comment'>
<div class='author'>Philip JÃ¤genstedt</div>
<div class='content'>Good bye load event, you won&#39;t be missed! Note that &#39;suspend&#39; can also fire before any video data is loaded at all, if a poster image is present. This is so that authors can add 100s of videos with poster images without worrying about killing the network.<br></div>
</div>
<div class='comment'>
<div class='author'>ben</div>
<div class='content'>If I understand correctly, you do not offer an event to play the media when it has finished downloading.<br>canplaythrough relies on the datarate not decreasing (which might happen) and suspend doesn&#39;t help either, as you say.<br>So now what? How can I make the sound play when its done loading? I want to be absolutely sure it&#39;ll finish playing without buffering in the middle.<br></div>
</div>
<div class='comment'>
<div class='author'>Robert O'Callahan</div>
<div class='content'>You can never be absolutely sure of that. In Gecko (and Chrome) the media resource has never &quot;finished downloading&quot;. It&#39;s just cached, and some of the data might be evicted to make room for other media data. You don&#39;t know how big the cache is, on a mobile device it might be quite small, so you can&#39;t know when that eviction might happen.<br>canplaythrough is our best guess. Just use that. But you probably should also check for &#39;suspend&#39; or fall back to a timeout, since we might never fire canplaythrough if the cache is small and your resource is large.<br></div>
</div>

</div>