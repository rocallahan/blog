---
layout: "post"
title: "More Travel"
date: "2008-05-02 22:58:00 +0000"
categories: "Mozilla"
permalink: "/2008/05/more-travel_02.html"
---
<div class="columns"><p>I'm about to hit the road again. On Sunday I fly to California for a MoCo Gecko team "work week" to plan out the next Gecko update. That should be exciting. I'll actually be staying in California for an additional week to attend the <a href="http://osq.cs.berkeley.edu/">Berkeley OSQ</a> retreat in Santa Cruz on May 15-16. In between I'll be hacking away at the Mozilla office and hanging out with some of my local <a href="http://www.cs.berkeley.edu/~dawnsong/">friends</a>. On Wednesday the 14th I plan to visit Stanford to give a talk.<br/><p>Lately I've been spending most of my time beating down the last Firefox 3 blockers. In the last few days I've been writing test infrastructure so we can have automated tests for key events generated by different international keyboard layouts. For example, pressing "α" on a Greek keyboard should be able to trigger shortcuts (e.g., the HTML <tt>accesskey</tt> attribute) labeled with "α" <em>or</em> "a". There have been some nasty late regressions in this area; it's very complex and there are conflicting user expectations. Behaviours vary by platform and locale and even within platform versions. <p>One problem I've run into is that I need to be able to use GDK's <a href="http://library.gnome.org/devel/gdk/stable/gdk-Keyboard-Handling.html">keymap APIs</a> with a GdkKeymap for the keyboard layout requested by a test, but as far as I can tell you can only get a GdkKeymap for the current keyboard layout for a screen. Having automated tests change the actual keyboard layout for your X screen is something we really want to avoid since it will have nasty side effects, especially if someone is trying to use their machine while running tests in the background... It's unfortunate because both Windows and Mac have reasonable APIs for working with application-selected keyboard layouts.<br/><p>On the side I've been doing a bit of work to speed up our SVG filter code, especially Gaussian blurs, which seem to be everyone's favourite filter demo --- for the next Gecko release, of course. It shouldn't take long and when I'm done I'll write up what I did and what else can be done for filter performance.</div><br/><br/>
<div class='comments'><h2>Comments</h2>
<div class='comment'>
<div class='author'>Jeff Walden</div>
<div class='content'>Run in a nested X server.  You can&#39;t use your machine while running tests in the background anyway, because not having focus causes a bunch of test screwups.  If I run, I find something else to do for 45 minutes, because it&#39;s pointless to attempt to do anything else on the computer.<br></div>
</div>
<div class='comment'>
<div class='author'>Robert O'Callahan</div>
<div class='content'>That&#39;s a pain if you just want to run the key tests.<br>Also I&#39;m afraid that if we were to crash at a bad time, we&#39;ll leave things in a bad state. I don&#39;t even know how to restore the keymap in GNOME.<br></div>
</div>
<div class='comment'>
<div class='author'>Adam</div>
<div class='content'>If you like beer, visit &quot;99 Bottles of Beer on the Wall&quot; or &quot;The Red&quot; in Santa Cruz.<br></div>
</div>
<div class='comment'>
<div class='author'>Benoit</div>
<div class='content'>Hi Robert, the French l10n team would actually be very interested by your work on accesskeys, if it was to work also with XUL.<br>Basically, we would like to be able to put an accesskey on the letter &quot;É&quot; which would work both with Alt+&quot;E&quot; and Alt+&quot;é&quot;, the latter not being available on all keyboards. Our main use case is the &quot;Edit&quot; menu in Firefox, translated as &quot;Édition&quot;. Other accentuated letters (i.e. è, à, ù, ç) are very common in French and would also benefit from this feature.<br>Could you provide a bug number or something for us to keep track of this? Thanks!<br></div>
</div>
<div class='comment'>
<div class='author'>Sylvain</div>
<div class='content'>I&#39;ve had very good experience with Xephyr as a nested X server (I don&#39;t remember seeing focus issues or very noticeable slowdowns while running the tests).<br>There could be a wrapper script launching it and running the tests with DISPLAY=:1. I didn&#39;t find a way restore the keymap too (I know of setxkbmap, but there&#39;s no getxkbmap). However, restarting Xephyr is very cheap in order to restore state.<br></div>
</div>
<div class='comment'>
<div class='author'>Zoltan</div>
<div class='content'>to display your current map type<br>setxkbmodemap -print<br></div>
</div>
<div class='comment'>
<div class='author'>Anonymous</div>
<div class='content'>sorry the proper command of course is<br>setxkbmap -print<br></div>
</div>

</div>